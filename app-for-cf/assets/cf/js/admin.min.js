let CloudflareAppAdmin={},__=wp.i18n.__,sprintf=wp.i18n.sprintf;CloudflareAppAdmin.Admin=function(){this.__construct()};
CloudflareAppAdmin.Admin.prototype={charts:[],__construct:function(){document.addEventListener("DOMContentLoaded",function(){document.querySelector("#dp_tabs.nav-tab-wrapper")&&this.init_tabs();document.querySelectorAll('[data-click="overlay"]').forEach(a=>{a.addEventListener("click",this.overlay.bind(this))});document.addEventListener("click",this.closeOverlay);document.querySelectorAll(".column-primary .row-actions .delete a").forEach(a=>{a.addEventListener("click",this.displayConfirm.bind(this))});
document.querySelectorAll('[form="cfSettingsForm"]').forEach(a=>{a.addEventListener("change",this.settings.bind(this))});this.__register()}.bind(this))},__register:function(){document.querySelectorAll('[data-init="dependent"] .primary:not(.is-reg)').forEach(a=>{a.addEventListener("change",this.dependent.bind(this));a.classList.add("is-reg");if("radio"===a.type){const c=new Event("change",{bubbles:!0});a.dispatchEvent(c)}});document.querySelectorAll(".dp-ui-toggle[data-overlay-href]:not(.is-reg)").forEach(a=>
{a.addEventListener("click",this.overlay.bind(this));a.classList.add("is-reg")})},init_tabs:function(){let a=window.location.hash.slice(5);if(!a){const c=document.querySelector(".nav-tab");c&&(a=c.id.slice(0,-4))}CloudflareAppAdmin._Admin.select_tab(a);document.querySelectorAll("#dp_tabs a").forEach(c=>{c.addEventListener("click",CloudflareAppAdmin._Admin.select_tab)})},select_tab:function(a){function c(b,f=400){b.style.transition="none !important";b.style.opacity=0;b.style.display="revert";b.style.transition=
"";setTimeout(()=>{b.style.opacity=1},0);setTimeout(()=>{b.style.opacity=""},f)}function d(b,f=400){b.style.transition="none !important";b.style.opacity=1;b.style.transition="";setTimeout(()=>{b.style.opacity=0},0);setTimeout(()=>{b.style.display="none"},f)}"object"===typeof a?(a=a.currentTarget.hash.slice(4)+"-tab",a=document.querySelector(a)):a=document.getElementById(a+"-tab");try{var e=a.id.slice(0,-4);document.getElementById("dp_current_tab").value=e}catch(b){document.getElementById("dp_current_tab").value=
"setup"}document.querySelectorAll(".nav-tab").forEach(b=>{b.classList.remove("nav-tab-active")});a.classList.add("nav-tab-active");document.querySelectorAll(".tab_content").forEach(b=>{b.style.display="none"});a=document.getElementById("dp_current_tab").value;document.querySelectorAll(`.group_${a}:not(.api_hideable)`).forEach(b=>{c(b)});e=document.querySelector("#app-for-cf_sidebar .pro");a=null!==document.querySelector(`.group_${a} .pro`);e&&(a?c(e):d(e))},overlay:function(a){let c=a.currentTarget.getAttribute("href");
c||(c=a.currentTarget.dataset.overlayHref);a.preventDefault();let d;try{d=new URL(c,window.location.origin)}catch(e){this.displayError(__("Invalid URL.","app-for-cf"));return}if(d.searchParams.get("_wpnonce"))return d.searchParams.set("ajax","1"),fetch(d.href,{method:"GET"}).then(e=>e.text()).then(e=>{if(e=(new DOMParser).parseFromString(e,"text/html").querySelector("#wpbody-content")){var b=e.querySelector("#screen-meta");b&&b.remove();if(b=e.querySelector(".submit")){var f=document.createElement("button");
f.className="dismiss button";f.textContent=__("Cancel","app-for-cf");b.appendChild(f)}else b=document.createElement("div"),f=document.createElement("button"),f.className="dismiss button",f.textContent=__("Close","app-for-cf"),b.appendChild(f),e.appendChild(b);var g=document.createElement("div");g.className="dp_overlay";g.innerHTML=e.innerHTML;(e=g.querySelector(".dismiss"))&&e.addEventListener("click",function(h){h.preventDefault();g.remove();return!1});document.body.appendChild(g);CloudflareAppAdmin._Admin.__register()}else this.displayError(__("Unexpected response structure.",
"app-for-cf"))}).catch(e=>{this.displayError(e.message||__("Request failed","app-for-cf"))}),!1;this.displayError(__("Missing CSRF token.","app-for-cf"))},closeOverlay:function(a){a.target.closest(".dp_overlay")||document.querySelectorAll(".dp_overlay").forEach(c=>c.remove())},flashMessage:function(a,c,d){"undefined"===typeof c&&(c=5E3);let e=document.getElementById("flashWrapper");e||(e=document.createElement("div"),e.id="flashWrapper",document.body.appendChild(e));const b=document.createElement("div");
b.className="flashMessage";const f=document.createElement("div");f.className="flashMessage-timer";f.style.transitionDuration=Math.max(500,c)/1E3+"s";const g=document.createElement("div");g.className="flashMessage-content";g.innerHTML=a;b.appendChild(f);b.appendChild(g);e.appendChild(b);requestAnimationFrame(()=>{b.classList.add("is-active")});setTimeout(()=>{b.classList.remove("is-active")},Math.max(500,c));setTimeout(()=>{b.remove();e.querySelector(".flashMessage")||e.remove();"function"===typeof d&&
d()},Math.max(500,c)+500)},displayMessage:function(a,c=null,d=!1){const e=c.currentTarget;c=document.createElement("div");c.className="dp_error";c.innerHTML=a;a=document.createElement("div");if(d)d=document.createElement("input"),d.type="submit",d.className="dismiss button button-primary",d.value=__("Okay","app-for-cf"),a.appendChild(d);else{d=document.createElement("input");d.type="submit";d.className="dismiss button button-primary";d.setAttribute("data-true","1");d.value=__("Yes","app-for-cf");
const b=document.createElement("input");b.type="submit";b.className="dismiss button";b.value=__("No","app-for-cf");a.appendChild(d);a.appendChild(b)}c.appendChild(a);c.querySelectorAll(".dismiss").forEach(b=>{b.addEventListener("click",function(f){this.getAttribute("data-true")&&window.location.replace(e.href);(f=this.closest(".dp_error"))&&f.remove()})});document.body.appendChild(c)},displayError:function(a){this.displayMessage(a,null,!0)},displayConfirm:function(a){a.preventDefault();var c=a.target.closest("tr")?.querySelector(".row-title strong");
c=c?c.textContent.trim():"";this.displayMessage(sprintf(__("Are you sure you want to delete %s?","app-for-cf"),c),a,!1);return!1},dependent:function(a){if("radio"===a.target.type){var c=a.target.closest("form");c||=a.target.closest("table");c&&c.querySelectorAll(`[name="${a.target.name}"]`).forEach(d=>{if(d=d.closest('[data-init="dependent"]')){const e=d.querySelectorAll(".dependent input, .dependent select"),b=d.querySelector(".primary")?.checked;e.forEach(f=>{f.disabled=!b})}})}else if(a=a.target.closest('[data-init="dependent"]')){c=
a.querySelectorAll(".dependent input, .dependent select");const d=a.querySelector(".primary")?.checked;c.forEach(e=>{e.disabled=!d})}},settings:function(a){a.preventDefault();let c={action:"app-for-cf_settings"};document.querySelectorAll('[form="cfSettingsForm"]').forEach(d=>{if("checkbox"!==d.type&&"radio"!==d.type||d.checked)c[d.name]=d.value});fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(c)}).then(d=>d.json()).then(d=>{void 0!==
d.error?this.displayError(d.error):this.flashMessage(d.message)});return!1}};CloudflareAppAdmin._Admin=new CloudflareAppAdmin.Admin;
