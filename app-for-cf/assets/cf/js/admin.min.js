let CloudflareAppAdmin={},__=wp.i18n.__,sprintf=wp.i18n.sprintf;CloudflareAppAdmin.Admin=function(){this.__construct()};
CloudflareAppAdmin.Admin.prototype={charts:[],__construct:function(){document.addEventListener("DOMContentLoaded",function(){document.querySelector("#dp_tabs.nav-tab-wrapper")&&this.init_tabs();document.querySelectorAll('[data-click="overlay"]').forEach(a=>{a.addEventListener("click",this.overlay.bind(this))});document.addEventListener("click",this.closeOverlay);document.querySelectorAll(".column-primary .row-actions .delete a").forEach(a=>{a.addEventListener("click",this.displayConfirm.bind(this))});
document.querySelectorAll('[form="cfSettingsForm"]').forEach(a=>{a.addEventListener("change",this.settings.bind(this))});this.__register()}.bind(this))},__register:function(){document.querySelectorAll('[data-init="dependent"] .primary:not(.is-reg)').forEach(a=>{a.addEventListener("change",this.dependent.bind(this));a.classList.add("is-reg");if("radio"===a.type){const b=new Event("change",{bubbles:!0});a.dispatchEvent(b)}});document.querySelectorAll(".dp-ui-toggle[data-overlay-href]:not(.is-reg)").forEach(a=>
{a.addEventListener("click",this.overlay.bind(this));a.classList.add("is-reg")})},init_tabs:function(){let a=window.location.hash.slice(5);if(!a){const b=document.querySelector(".nav-tab");b&&(a=b.id.slice(0,-4))}CloudflareAppAdmin._Admin.select_tab(a);document.querySelectorAll("#dp_tabs a").forEach(b=>{b.addEventListener("click",CloudflareAppAdmin._Admin.select_tab)})},select_tab:function(a){function b(d,f=400){function g(h){k||=h;h-=k;d.style.opacity=Math.min(h/f,1);h<f?requestAnimationFrame(g):
d.style.opacity=""}d.style.opacity=0;d.style.display="revert";let k=null;requestAnimationFrame(g)}function c(d,f=400){function g(h){k||=h;h-=k;d.style.opacity=Math.max(1-h/f,0);h<f?requestAnimationFrame(g):d.style.display="none"}d.style.opacity=1;let k=null;requestAnimationFrame(g)}"object"===typeof a?(a=a.currentTarget.hash.slice(4)+"-tab",a=document.querySelector(a)):a=document.getElementById(a+"-tab");try{var e=a.id.slice(0,-4);document.getElementById("dp_current_tab").value=e}catch(d){document.getElementById("dp_current_tab").value=
"setup"}document.querySelectorAll(".nav-tab").forEach(d=>{d.classList.remove("nav-tab-active")});a.classList.add("nav-tab-active");document.querySelectorAll(".tab_content").forEach(d=>{d.style.display="none"});a=document.getElementById("dp_current_tab").value;document.querySelectorAll(`.group_${a}:not(.api_hideable)`).forEach(d=>{b(d,400)});e=document.querySelector("#app-for-cf_sidebar .pro");a=null!==document.querySelector(`.group_${a} .pro`);e&&(a?b(e,400):c(e,400))},overlay:function(a){let b=a.currentTarget.getAttribute("href");
b||(b=a.currentTarget.dataset.overlayHref);a.preventDefault();let c;try{c=new URL(b,window.location.origin)}catch(e){this.displayError(__("Invalid URL.","app-for-cf"));return}if(c.searchParams.get("_wpnonce"))return c.searchParams.set("ajax","1"),fetch(c.href,{method:"GET"}).then(e=>e.text()).then(e=>{if(e=(new DOMParser).parseFromString(e,"text/html").querySelector("#wpbody-content")){var d=e.querySelector("#screen-meta");d&&d.remove();if(d=e.querySelector(".submit")){var f=document.createElement("button");
f.className="dismiss button";f.textContent=__("Cancel","app-for-cf");d.appendChild(f)}else d=document.createElement("div"),f=document.createElement("button"),f.className="dismiss button",f.textContent=__("Close","app-for-cf"),d.appendChild(f),e.appendChild(d);var g=document.createElement("div");g.className="dp_overlay";g.innerHTML=e.innerHTML;(e=g.querySelector(".dismiss"))&&e.addEventListener("click",function(k){k.preventDefault();g.remove();return!1});document.body.appendChild(g);CloudflareAppAdmin._Admin.__register()}else this.displayError(__("Unexpected response structure.",
"app-for-cf"))}).catch(e=>{this.displayError(e.message||__("Request failed","app-for-cf"))}),!1;this.displayError(__("Missing CSRF token.","app-for-cf"))},closeOverlay:function(a){a.target.closest(".dp_overlay")||document.querySelectorAll(".dp_overlay").forEach(b=>b.remove())},flashMessage:function(a,b,c){"undefined"===typeof b&&(b=5E3);let e=document.getElementById("flashWrapper");e||(e=document.createElement("div"),e.id="flashWrapper",document.body.appendChild(e));const d=document.createElement("div");
d.className="flashMessage";const f=document.createElement("div");f.className="flashMessage-timer";f.style.transitionDuration=Math.max(500,b)/1E3+"s";const g=document.createElement("div");g.className="flashMessage-content";g.innerHTML=a;d.appendChild(f);d.appendChild(g);e.appendChild(d);requestAnimationFrame(()=>{d.classList.add("is-active")});setTimeout(()=>{d.classList.remove("is-active")},Math.max(500,b));setTimeout(()=>{d.remove();e.querySelector(".flashMessage")||e.remove();"function"===typeof c&&
c()},Math.max(500,b)+500)},displayMessage:function(a,b=null,c=!1){const e=b.currentTarget;b=document.createElement("div");b.className="dp_error";b.innerHTML=a;a=document.createElement("div");if(c)c=document.createElement("input"),c.type="submit",c.className="dismiss button button-primary",c.value=__("Okay","app-for-cf"),a.appendChild(c);else{c=document.createElement("input");c.type="submit";c.className="dismiss button button-primary";c.setAttribute("data-true","1");c.value=__("Yes","app-for-cf");
const d=document.createElement("input");d.type="submit";d.className="dismiss button";d.value=__("No","app-for-cf");a.appendChild(c);a.appendChild(d)}b.appendChild(a);b.querySelectorAll(".dismiss").forEach(d=>{d.addEventListener("click",function(f){this.getAttribute("data-true")&&window.location.replace(e.href);(f=this.closest(".dp_error"))&&f.remove()})});document.body.appendChild(b)},displayError:function(a){this.displayMessage(a,null,!0)},displayConfirm:function(a){a.preventDefault();var b=a.target.closest("tr")?.querySelector(".row-title strong");
b=b?b.textContent.trim():"";this.displayMessage(sprintf(__("Are you sure you want to delete %s?","app-for-cf"),b),a,!1);return!1},dependent:function(a){if("radio"===a.target.type){var b=a.target.closest("form");b||=a.target.closest("table");b&&b.querySelectorAll(`[name="${a.target.name}"]`).forEach(c=>{if(c=c.closest('[data-init="dependent"]')){const e=c.querySelectorAll(".dependent input, .dependent select"),d=c.querySelector(".primary")?.checked;e.forEach(f=>{f.disabled=!d})}})}else if(a=a.target.closest('[data-init="dependent"]')){b=
a.querySelectorAll(".dependent input, .dependent select");const c=a.querySelector(".primary")?.checked;b.forEach(e=>{e.disabled=!c})}},settings:function(a){a.preventDefault();let b={action:"app-for-cf_settings"};document.querySelectorAll('[form="cfSettingsForm"]').forEach(c=>{if("checkbox"!==c.type&&"radio"!==c.type||c.checked)b[c.name]=c.value});fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(b)}).then(c=>c.json()).then(c=>{void 0!==
c.error?this.displayError(c.error):this.flashMessage(c.message)});return!1}};CloudflareAppAdmin._Admin=new CloudflareAppAdmin.Admin;